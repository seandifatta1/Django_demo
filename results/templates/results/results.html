{% extends 'base.html' %}
{% load static %}

{% block title %}Results{% endblock %}

{% block extra_head %}
    <style>
        .results-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 20px;
        }

        .results {
            display: flex;
            justify-content: space-between;
            width: 80%;
        }

        .conference {
            width: 45%;
        }

        .conference h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #002244; /* Dark blue */
        }

        .team-table {
            width: 100%;
            border-collapse: collapse;
        }

        .team-table th, .team-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            text-transform: capitalize; /* Capitalize first letter */
        }

        .team-table th {
            background-color: #002244; /* Dark blue */
            color: white;
        }

        .team-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .message {
            text-align: center;
            margin-top: 40px;
            font-size: 24px;
        }

        .congratulations {
            color: #28a745; /* Green */
        }

        .consolation {
            color: #ff0000; /* Red */
        }

        .reset-button {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 20px; /* Add margin to the bottom */
        }

        .reset-button button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #002244; /* Dark blue */
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .reset-button button:hover {
            background-color: #001122; /* Darker blue */
        }
    </style>
{% endblock %}

{% block content %}
    <div class="results-container">
        <div class="results">
            <div class="conference">
                <h2>AFC Teams</h2>
                <table class="team-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Wins</th>
                            <th>Losses</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in afc_top_7 %}
                        <tr>
                            <td>{{ team.name|capfirst }}</td>
                            <td>{{ team.wins }}</td>
                            <td>{{ team.losses }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="conference">
                <h2>NFC Teams</h2>
                <table class="team-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Wins</th>
                            <th>Losses</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in nfc_top_7 %}
                        <tr>
                            <td>{{ team.name|capfirst }}</td>
                            <td>{{ team.wins }}</td>
                            <td>{{ team.losses }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if is_in_top_7 %}
    <div class="message congratulations">
        Congratulations, the {{ favorite_team|capfirst }} has made it to the playoffs!
    </div>
    {% else %}
    <div class="message consolation">
        Unfortunately, the {{ favorite_team|capfirst }} did not qualify for the playoffs. Better luck next year!
    </div>
    {% endif %}

    <div class="reset-button">
        <form method="post" action="{% url 'reset_wins_losses' %}" onsubmit="redirectToFavoriteTeam(event)">
            {% csrf_token %}
            <button type="submit">Reset</button>
        </form>
    </div>
{% endblock %}

{% block extra_script %}
    <script>
        function redirectToFavoriteTeam(event) {
            event.preventDefault();
            fetch("{% url 'reset_wins_losses' %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/teams/{{ favorite_team.name }}';
                } else {
                    alert('Reset failed');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
{% endblock %}
